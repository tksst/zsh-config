# syntax=docker/dockerfile:1.4.1
FROM debian:bullseye-slim@sha256:0e75382930ceb533e2f438071307708e79dc86d9b8e433cc6dd1a96872f2651d

# enable snapshot
RUN cd /etc/apt && \
  perl -pe 's/^(?=deb)/# /g' < sources.list | perl -pe 's|^#(?= deb http://snapshot.debian.org/)||g' > sources.list-new && \
  mv sources.list-new sources.list

RUN apt-get -o Acquire::Check-Valid-Until=false update

RUN DEBIAN_FRONTEND=noninteractive apt-get install --no-install-recommends --download-only -y build-essential devscripts debhelper
RUN DEBIAN_FRONTEND=noninteractive apt-get install --no-install-recommends -y build-essential devscripts debhelper

COPY --chmod=644 files/ /work/resources/files/
COPY debian/ /work/resources/debian/

RUN cd /work/resources && debuild -us -uc

RUN mkdir /results && cp /work/tksst-zsh-config_* /results/
